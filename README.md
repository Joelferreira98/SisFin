# SisFin - Sistema de Gest√£o Financeira

Sistema completo de gest√£o financeira com funcionalidades avan√ßadas de comunica√ß√£o WhatsApp, PWA e deployment para VPS.

## üöÄ Caracter√≠sticas Principais

### üíº Gest√£o Financeira Completa
- **Clientes**: Cadastro completo com dados pessoais e de contato
- **Contas a Receber**: Controle de valores a receber com status e vencimentos
- **Contas a Pagar**: Gest√£o de pagamentos com fornecedores
- **Relat√≥rios**: Dashboard com m√©tricas financeiras detalhadas
- **Vendas Parceladas**: Sistema de confirma√ß√£o com assinatura digital

### üì± Integra√ß√£o WhatsApp
- **Evolution API**: Conex√£o via WhatsApp-Baileys com QR Code
- **Mensagens Autom√°ticas**: Envio autom√°tico de confirma√ß√µes e cobran√ßas
- **Lembretes**: Sistema automatizado de lembretes de pagamento
- **Multi-usu√°rio**: Cada usu√°rio gerencia suas pr√≥prias inst√¢ncias

### üé® Interface Moderna
- **PWA**: Progressive Web App instal√°vel
- **Responsivo**: Interface adapt√°vel para todos os dispositivos
- **Personaliza√ß√£o**: Logo, nome e tema customiz√°veis
- **Offline**: Funciona sem conex√£o com internet

### üë• Sistema de Usu√°rios
- **Autentica√ß√£o**: Login seguro com sess√µes persistentes
- **Perfis**: Usu√°rios normais e administradores
- **Planos**: Sistema de assinatura com limita√ß√µes
- **Controle**: Solicita√ß√µes de mudan√ßa de plano

## üõ†Ô∏è Tecnologias

**Frontend:**
- React 18 + TypeScript
- Vite + Tailwind CSS
- shadcn/ui components
- TanStack Query
- PWA Service Worker

**Backend:**
- Node.js + Express
- PostgreSQL + Drizzle ORM
- Evolution API
- Cron Jobs autom√°ticos

**Deployment:**
- Docker + Docker Compose
- PostgreSQL 15 container
- Nginx proxy reverso
- SSL autom√°tico

## üì¶ Instala√ß√£o R√°pida

### üö® ERROS VPS: Solu√ß√£o Completa

Se voc√™ est√° vendo erros como:
- `DATABASE_URL must be set`
- `TypeError [ERR_INVALID_ARG_TYPE]: The "paths[0]" argument must be of type string`

**SOLU√á√ÉO DEFINITIVA:**
```bash
# Script completo que resolve todos os erros
wget https://raw.githubusercontent.com/Joelferreira98/SisFin/main/vps-complete-fix.sh
chmod +x vps-complete-fix.sh
./vps-complete-fix.sh

# Iniciar aplica√ß√£o
./start-app-vps.sh
```

**Documenta√ß√£o completa:** `README_VPS_ERRO.md`

### M√©todo 1: Desenvolvimento Local

```bash
# Clonar o reposit√≥rio
git clone https://github.com/Joelferreira98/SisFin.git
cd SisFin

# Instalar depend√™ncias
npm install

# Configurar vari√°veis de ambiente
cp .env.example .env
# Editar o arquivo .env com suas configura√ß√µes

# Configurar banco de dados PostgreSQL
# Op√ß√£o A: Script automatizado
chmod +x setup-vps-db.sh
./setup-vps-db.sh

# Op√ß√£o B: Docker PostgreSQL
docker run --name postgres-sisfin -e POSTGRES_PASSWORD=financepass -e POSTGRES_DB=financedb -e POSTGRES_USER=financeuser -p 5432:5432 -d postgres:15

# Aplicar schema do banco
npm run db:push

# Executar em modo desenvolvimento
npm run dev
```

**Acesse:** http://localhost:5000

### M√©todo 2: Deployment VPS com Docker

```bash
# Clonar reposit√≥rio
git clone https://github.com/Joelferreira98/SisFin.git
cd SisFin

# Executar deployment autom√°tico
chmod +x deploy.sh
./deploy.sh

# Configurar vari√°veis de ambiente
cp .env.example .env
# Editar .env com configura√ß√µes do VPS

# Iniciar com Docker
docker-compose up -d

# Verificar status
docker-compose ps
```

## ‚öôÔ∏è Configura√ß√£o

### Arquivo .env

```env
# Banco de Dados PostgreSQL
DATABASE_URL=postgresql://financeuser:financepass@localhost:5432/financedb

# Sess√£o (use chave aleat√≥ria de 32+ caracteres)
SESSION_SECRET=sua-chave-secreta-super-segura

# Evolution API WhatsApp
EVOLUTION_API_URL=https://sua-evolution-api.com
EVOLUTION_API_KEY=sua-chave-da-api
EVOLUTION_INSTANCE_NAME=instancia-padrao

# Ambiente
NODE_ENV=development
```

### Configura√ß√£o PostgreSQL

```sql
-- Criar banco de dados
CREATE DATABASE financedb;

-- Criar usu√°rio
CREATE USER financeuser WITH PASSWORD 'financepass';
GRANT ALL PRIVILEGES ON DATABASE financedb TO financeuser;
```

### Configura√ß√£o R√°pida PostgreSQL
```bash
# Instalar PostgreSQL
sudo apt install postgresql postgresql-contrib

# Usar script automatizado
chmod +x setup-vps-db.sh
./setup-vps-db.sh

# Aplicar schema
npm run db:push
```

### Configura√ß√£o Evolution API

1. **Obter inst√¢ncia Evolution API**
2. **Configurar URL e chave da API**
3. **Definir inst√¢ncia padr√£o**
4. **Testar conex√£o:**

```bash
curl -H "apikey: SUA_CHAVE" https://sua-evolution-api.com/instance/connect/INSTANCIA
```

## üê≥ Docker Deployment

### Pr√©-requisitos VPS
- Ubuntu 20.04+ ou CentOS 8+
- Docker Engine 20.10+
- Docker Compose 2.0+
- 2GB RAM m√≠nimo
- 20GB espa√ßo em disco

### Deployment Autom√°tico

```bash
# Clonar projeto
git clone https://github.com/Joelferreira98/SisFin.git
cd SisFin

# Executar script de deployment
chmod +x deploy.sh
./deploy.sh

# Configurar .env
cp .env.example .env
nano .env

# Iniciar servi√ßos
docker-compose up -d

# Verificar logs
docker-compose logs -f app
```

### Comandos Docker √öteis

```bash
# Parar servi√ßos
docker-compose stop

# Reiniciar servi√ßos
docker-compose restart

# Ver logs em tempo real
docker-compose logs -f app

# Backup do banco
docker-compose exec db mysqldump -u root -p financedb > backup.sql

# Restaurar backup
docker-compose exec -i db mysql -u root -p financedb < backup.sql
```

## üì± PWA - Progressive Web App

### Instala√ß√£o Mobile
1. Acesse o sistema pelo navegador
2. Toque no menu "Adicionar √† tela inicial"
3. Confirme a instala√ß√£o
4. Use como app nativo

### Recursos PWA
- ‚úÖ Instala√ß√£o nativa
- ‚úÖ Funcionamento offline
- ‚úÖ √çcones personaliz√°veis
- ‚úÖ Notifica√ß√µes push
- ‚úÖ Manifest din√¢mico

## üîê Seguran√ßa

### Medidas Implementadas
- Autentica√ß√£o por sess√£o
- Valida√ß√£o de dados
- Sanitiza√ß√£o de entrada
- Controle de acesso
- Backup autom√°tico

### Configura√ß√£o SSL (VPS)

```bash
# Instalar Certbot
sudo apt install certbot python3-certbot-nginx

# Obter certificado
sudo certbot --nginx -d seu-dominio.com

# Configurar renova√ß√£o autom√°tica
sudo crontab -e
# Adicionar: 0 12 * * * /usr/bin/certbot renew --quiet
```

## üìä Funcionalidades Detalhadas

### Gest√£o de Clientes
- Cadastro completo (nome, documento, contato)
- Hist√≥rico de transa√ß√µes
- Integra√ß√£o com WhatsApp
- Relat√≥rios personalizados

### Contas a Receber
- Controle de vencimentos
- Status autom√°tico (pendente, pago, vencido)
- Gera√ß√£o de lembretes
- Relat√≥rios financeiros

### Contas a Pagar
- Gest√£o de fornecedores
- Controle de pagamentos
- Alertas de vencimento
- Fluxo de caixa

### Vendas Parceladas
- Cria√ß√£o de vendas
- Confirma√ß√£o por assinatura digital
- Workflow de aprova√ß√£o
- Gera√ß√£o autom√°tica de parcelas

### Sistema WhatsApp
- Conex√£o via QR Code
- Mensagens autom√°ticas
- Templates personaliz√°veis
- Logs de envio

## üóÇÔ∏è Estrutura do Projeto

```
SisFin/
‚îú‚îÄ‚îÄ client/                 # Frontend React
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/     # Componentes reutiliz√°veis
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hooks/         # Hooks customizados
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ lib/           # Utilit√°rios
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pages/         # P√°ginas da aplica√ß√£o
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ App.tsx        # Componente principal
‚îÇ   ‚îî‚îÄ‚îÄ public/            # Arquivos est√°ticos
‚îú‚îÄ‚îÄ server/                # Backend Express
‚îÇ   ‚îú‚îÄ‚îÄ auth.ts           # Sistema de autentica√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ db.ts             # Conex√£o com banco
‚îÇ   ‚îú‚îÄ‚îÄ routes.ts         # Rotas da API
‚îÇ   ‚îú‚îÄ‚îÄ storage.ts        # Camada de dados
‚îÇ   ‚îî‚îÄ‚îÄ whatsapp.ts       # Integra√ß√£o WhatsApp
‚îú‚îÄ‚îÄ shared/               # C√≥digo compartilhado
‚îÇ   ‚îî‚îÄ‚îÄ schema.ts         # Schema do banco
‚îú‚îÄ‚îÄ docker-compose.yml    # Configura√ß√£o Docker
‚îú‚îÄ‚îÄ Dockerfile           # Imagem da aplica√ß√£o
‚îú‚îÄ‚îÄ deploy.sh            # Script de deployment
‚îú‚îÄ‚îÄ .env.example         # Exemplo de configura√ß√£o
‚îî‚îÄ‚îÄ README.md            # Esta documenta√ß√£o
```

## üîß Scripts Dispon√≠veis

```bash
# Desenvolvimento
npm run dev          # Servidor desenvolvimento
npm run build        # Build produ√ß√£o
npm run start        # Servidor produ√ß√£o
npm run check        # Verificar TypeScript
npm run db:push      # Aplicar schema no banco

# Deployment
./deploy.sh                    # Deployment autom√°tico
./package-for-deployment.sh    # Criar pacote deployment
```

## üîç Monitoramento

### Logs do Sistema
```bash
# Logs da aplica√ß√£o
docker-compose logs -f app

# Logs do banco
docker-compose logs -f db

# Logs do Nginx
tail -f /var/log/nginx/access.log
```

### M√©tricas
```bash
# Status containers
docker-compose ps

# Uso de recursos
docker stats

# Espa√ßo em disco
df -h
```

## üÜò Solu√ß√£o de Problemas

### Problemas Comuns

**1. Erro de conex√£o MySQL:**
```bash
# Verificar se MySQL est√° rodando
docker-compose ps db

# Reiniciar servi√ßo
docker-compose restart db

# Verificar logs
docker-compose logs db
```

**2. Aplica√ß√£o n√£o inicia:**
```bash
# Verificar vari√°veis de ambiente
docker-compose exec app env

# Verificar logs
docker-compose logs app
```

**3. Problemas WhatsApp:**
```bash
# Testar conex√£o Evolution API
curl -H "apikey: SUA_CHAVE" https://sua-evolution-api.com/instance/connect/INSTANCIA

# Verificar logs WhatsApp
docker-compose logs app | grep -i whatsapp
```

**4. Erro 502 Bad Gateway:**
```bash
# Verificar se aplica√ß√£o est√° rodando
docker-compose ps

# Verificar configura√ß√£o Nginx
nginx -t

# Reiniciar Nginx
systemctl reload nginx
```

## üìà Backup e Manuten√ß√£o

### Backup Autom√°tico
```bash
#!/bin/bash
# Script inclu√≠do no projeto
BACKUP_DIR="/opt/backups"
DATE=$(date +%Y%m%d_%H%M%S)

# Backup banco
docker-compose exec -T db mysqldump -u root -p$MYSQL_ROOT_PASSWORD financedb > $BACKUP_DIR/db_$DATE.sql

# Backup arquivos
tar -czf $BACKUP_DIR/files_$DATE.tar.gz /opt/SisFin
```

### Manuten√ß√£o Regular
```bash
# Limpar containers antigos
docker system prune -a

# Verificar espa√ßo em disco
df -h

# Atualizar sistema
apt update && apt upgrade -y

# Verificar logs de erro
grep -i error /var/log/nginx/error.log
```

## ü§ù Contribui√ß√£o

1. Fork o reposit√≥rio
2. Crie uma branch: `git checkout -b feature/nova-funcionalidade`
3. Commit suas mudan√ßas: `git commit -m 'Adiciona nova funcionalidade'`
4. Push para a branch: `git push origin feature/nova-funcionalidade`
5. Abra um Pull Request

## üìû Suporte

### Reposit√≥rio
- **GitHub**: https://github.com/Joelferreira98/SisFin
- **Issues**: Para reportar bugs e solicitar funcionalidades
- **Wiki**: Documenta√ß√£o adicional
- **Releases**: Vers√µes e changelog

### Documenta√ß√£o
- **Deployment**: `DEPLOYMENT_GUIDE.md`
- **Configura√ß√£o**: `.env.example`
- **Schema**: `shared/schema.ts`
- **API**: Documenta√ß√£o das rotas

## üìÑ Licen√ßa

Este projeto est√° sob a licen√ßa MIT. Consulte o arquivo `LICENSE` para mais detalhes.

## üìä Status do Projeto

- ‚úÖ **Funcional**: Sistema completo e operacional
- ‚úÖ **Testado**: Ambiente de produ√ß√£o
- ‚úÖ **Documentado**: Guias completos
- ‚úÖ **Deploy Ready**: Pronto para VPS
- ‚úÖ **PWA**: App web progressiva
- ‚úÖ **Mobile**: Design responsivo

---

**Desenvolvido por Joel Ferreira - Sistema de Gest√£o Financeira**

üîó **Reposit√≥rio**: https://github.com/Joelferreira98/SisFin